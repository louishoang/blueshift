<div class="row">
  <div class="large-12 columns">
    <div class="row">
      <div class="large-3 columns">
        <%= image_tag(@show.poster, alt: "Poster", class: "poster")%><br>
      </div>
      <div class="large-9 columns">
        <div class="panel">
          <h4 class="hide-for-small"><%= @show.name %></h4>
          <h6 class="hide-for-small"><%= @show.genre.name %></h6>
          <h6 class="hide-for-small"><%= @show.year %></h6>
          <h6>Average rating: <%= @show.average_rating %></h6>
          <h6 class="subheader"><hr/><%= @show.description %></h6>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="large-12">
        <div class="panel">
          <h5>Add Review</h5>
            <%= form_for [@show, @review] do |f| %>
              <div>
                <%= f.label :title %><br />
                <%= f.text_field :title %>
              </div>
              <div>
                <%= f.label :body %><br />
                <%= f.text_area :body %>
              </div>
              <div>
                <%= f.label :rating %>
                <%= f.select :rating, (1..5) %>
              </div>
              <div><%= f.submit "Add review", class: "nice small radius blue button" %></div>
            <% end %>
        </div>
      </div>
    </div>

  <% @reviews.each do |review| %>
    <div class="row">
      <div class="large-12">
        <div class="panel">
          <div>
            <h5><strong><%= review.title %></strong></h5>
          </div>
          <div>
              <h6><%= review.body %></h6>
              <p>
                Current Score: <%= review.vote_score  %>
              </p>
              <%= link_to "upvote", upvote_review_path(review), method: :post %>
              <%= link_to "downvote", downvote_review_path(review), method: :post %>
              <h6>
                <% if current_user.username == review.user.username  || current_user.role == "admin"%>
                  <%= link_to "Edit review", edit_show_review_path(@show, review) %>
                  <%= link_to "Delete review", show_review_path(@show, review) %>
                <% end %>
              </h6></hr>

              <h6>
                <%= link_to "Add comment", new_show_review_comment_path(@show, review, @comment), class: "nice small radius blue button" %>
              </h6>

              <ul>
                <% @show.reviews.order(created_at: :desc).each do |review| %>
                <li>
                  <%= link_to review.user.username, user_path(review.user.id) %> Reviewed At:  <%= review.created_at %>
                  <p>
                    <%= review.title %>
                  </p>
                  <p>
                    <%= review.body %>
                  </p>
                  <div class="panel">
                    <% review.comments.each do |comment| %>
                      <li>
                        <%= link_to comment.user.username, user_path(comment.user.id) %> commented:<br>
                        <%= comment.text %>
                        <% if comment.owner?(current_user) %>
                          <p>
                            <%= link_to "Edit comment ", edit_show_review_comment_path(@show, review, comment), class: "nice small radius blue button" %>
                            <%= link_to "Delete comment", show_review_comment_path(@show, review, comment), class: "nice small radius blue button" %>
                          </p>
                        <% end %>
                      </li>
                    <% end %>
                  </div>
                <% end %>
              </ul>
          </div>
        </div>
      </div>
  <% end %>
